version: '2'
sql:
  - engine: postgresql
    schema: internal/db/migrations
    queries: internal/db/queries
    gen:
      go:
        package: sqlc
        out: internal/db/sqlc
        sql_package: 'pgx/v5'
        emit_pointers_for_null_types: true
        emit_json_tags: true
        overrides:
          # timestamptz to time.Time (pgx compatible)
          - db_type: 'timestamptz'
            nullable: true
            go_type:
              type: 'time.Time'
              pointer: true
          - db_type: 'timestamptz'
            nullable: false
            go_type:
              type: 'time.Time'


          # double precision to float64
          - db_type: 'double precision'
            nullable: false
            go_type:
              type: 'float64'
          - db_type: 'double precision'
            nullable: true
            go_type:
              type: 'float64'
              pointer: true

          # int to int32
          - db_type: 'pg_catalog.int4'
            nullable: false
            go_type:
              type: 'int32'
          - db_type: 'pg_catalog.int4'
            nullable: true
            go_type:
              type: 'int32'
              pointer: true

          # money fields - use custom Money for JSONB
          - column: 'accounts.anchor_balance'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'transactions.tx_amount'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'transactions.balance_after'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'transactions.foreign_amount'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'receipts.total_amount'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'receipts.tax_amount'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'receipt_items.unit_price'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true
          - column: 'receipt_items.line_total'
            go_type:
              import: 'ariand/internal/types'
              type: 'Money'
              pointer: true

          # pg json to go json
          - db_type: 'pg_catalog.jsonb'
            nullable: false
            go_type:
              import: 'encoding/json'
              type: 'RawMessage'
          - db_type: 'pg_catalog.jsonb'
            nullable: true
            go_type:
              import: 'encoding/json'
              type: 'RawMessage'
              pointer: true

          # pg uuid to google/uuid
          - db_type: 'uuid'
            nullable: false
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
          - db_type: 'uuid'
            nullable: true
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
              pointer: true

          # date to time.Time
          - db_type: 'date'
            nullable: false
            go_type:
              type: 'time.Time'
          - db_type: 'date'
            nullable: true
            go_type:
              type: 'time.Time'
              pointer: true

          # map columns directly to proto enums
          - column: 'accounts.account_type'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'AccountType'
          - column: 'transactions.tx_direction'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'TransactionDirection'
          - column: 'transactions.cat_status'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'CategorizationStatus'
          - column: 'receipts.engine'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'ReceiptEngine'
          - column: 'receipts.parse_status'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'ReceiptParseStatus'
          - column: 'receipts.link_status'
            go_type:
              import: 'ariand/internal/gen/arian/v1'
              type: 'ReceiptLinkStatus'
