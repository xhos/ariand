version: '2'
sql:
  - engine: postgresql
    schema: internal/db/migrations
    queries: internal/db/queries
    gen:
      go:
        package: sqlcdb
        out: internal/db/sqlc
        sql_package: 'pgx/v5'
        emit_pointers_for_null_types: true
        emit_json_tags: true
        overrides:
          # pg time to std time time
          - db_type: 'timestamptz'
            nullable: true
            go_type:
              import: 'time'
              type: 'Time'
              pointer: true
          - db_type: 'timestamptz'
            nullable: false
            go_type:
              import: 'time'
              type: 'Time'

          # numeric to decimal
          - db_type: 'pg_catalog.numeric'
            nullable: false
            go_type:
              import: 'github.com/shopspring/decimal'
              type: 'Decimal'
          - db_type: 'pg_catalog.numeric'
            nullable: true
            go_type:
              import: 'github.com/shopspring/decimal'
              type: 'Decimal'
              pointer: true

          # pg json to go json
          - db_type: 'pg_catalog.jsonb'
            nullable: false
            go_type:
              import: 'encoding/json'
              type: 'RawMessage'
          - db_type: 'pg_catalog.jsonb'
            nullable: true
            go_type:
              import: 'encoding/json'
              type: 'RawMessage'
              pointer: true

          # pg uuid to google/uuid
          - db_type: 'uuid'
            nullable: false
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
          - db_type: 'uuid'
            nullable: true
            go_type:
              import: 'github.com/google/uuid'
              type: 'UUID'
              pointer: true

          # map columns directly to proto enums
          - column: 'accounts.account_type'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'AccountType'
          - column: 'transactions.tx_direction'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'TransactionDirection'
          - column: 'transactions.cat_status'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'CategorizationStatus'
          - column: 'receipts.engine'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'ReceiptEngine'
          - column: 'receipts.parse_status'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'ReceiptParseStatus'
          - column: 'receipts.link_status'
            go_type:
              import: 'ariand/gen/go/ariand/v1'
              type: 'ReceiptLinkStatus'
