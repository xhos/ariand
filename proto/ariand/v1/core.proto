syntax = "proto3";

package ariand.v1;

import "google/protobuf/timestamp.proto";
import "google/type/date.proto";
import "google/type/money.proto";

option go_package = "ariand/gen/go/ariand/v1;ariandv1";

// ----- enums ----------

enum AccountType {
  ACCOUNT_UNSPECIFIED = 0;
  ACCOUNT_CHEQUING = 1;
  ACCOUNT_SAVINGS = 2;
  ACCOUNT_CREDIT_CARD = 3;
  ACCOUNT_INVESTMENT = 4;
  ACCOUNT_OTHER = 5;
}

enum TransactionDirection {
  DIRECTION_UNSPECIFIED = 0;
  DIRECTION_INCOMING = 1;
  DIRECTION_OUTGOING = 2;
}

enum CategorizationStatus {
  CATEGORIZATION_UNSPECIFIED = 0;
  CATEGORIZATION_NONE = 1;
  CATEGORIZATION_AUTO = 2;
  CATEGORIZATION_MANUAL = 3;
  CATEGORIZATION_VERIFIED = 4;
}

enum ReceiptEngine {
  ENGINE_UNSPECIFIED = 0;
  ENGINE_GEMINI = 1;
  ENGINE_LOCAL = 2;
}

enum ReceiptParseStatus {
  PARSE_STATUS_UNSPECIFIED = 0;
  PARSE_STATUS_PENDING = 1;
  PARSE_STATUS_SUCCESS = 2;
  PARSE_STATUS_FAILED = 3;
}

enum ReceiptLinkStatus {
  LINK_STATUS_UNSPECIFIED = 0;
  LINK_STATUS_UNLINKED = 1;
  LINK_STATUS_MATCHED = 2;
  LINK_STATUS_NEEDS_VERIFICATION = 3;
}

// ----- reusable messages ----------

message Location {
  double latitude = 1;       // WGS84 decimal degrees
  double longitude = 2;      // WGS84 decimal degrees
  string source = 3;         // e.g. "gps", "ip", "manual"
  optional string label = 4; // human-readable place name
}

message Cursor {
  google.protobuf.Timestamp date = 1;
  optional int64 id = 2;
}

// ----- core domain messages ----------

message Account {
  int64 id = 1;
  string name = 2;
  string bank = 3;
  AccountType type = 4;
  google.type.Money anchor_balance = 5;
  google.protobuf.Timestamp anchor_date = 6;
  google.protobuf.Timestamp created_at = 7;
  google.protobuf.Timestamp updated_at = 8;
  optional string alias = 9;
}

message Category {
  int64 id = 1;
  string slug = 2;  // e.g. "food.groceries"
  string label = 3; // e.g. "Groceries"
  string color = 4; // hex code, e.g. "#FF0000"
  google.protobuf.Timestamp created_at = 5;
  google.protobuf.Timestamp updated_at = 6;
}

message Transaction {
  int64 id = 1;
  google.protobuf.Timestamp tx_date = 2;
  google.type.Money tx_amount = 3;
  TransactionDirection direction = 4;
  int64 account_id = 5;

  // metadata
  optional string email_id = 6;
  optional string description = 7;
  optional Location location = 8;

  // categorization
  optional int64 category_id = 9;
  CategorizationStatus categorization_status = 10;

  // merchant & notes
  optional string merchant = 11;
  optional string user_notes = 12;

  // balance after this tx
  google.type.Money balance_after = 13;

  // AI suggestions
  repeated string suggestions = 14;

  // receipt linkage
  optional int64 receipt_id = 15;

  // FX details
  optional google.type.Money foreign_amount = 16;
  optional double exchange_rate = 17;

  google.protobuf.Timestamp created_at = 18;
  google.protobuf.Timestamp updated_at = 19;
}

message TransactionWithScore {
  Transaction transaction = 1;
  double merchant_score = 2;
}

message ReceiptItem {
  int64 id = 1;
  int64 receipt_id = 2;
  int32 line_number = 3;
  string name = 4;
  double quantity = 5;
  google.type.Money unit_price = 6;
  google.type.Money line_total = 7;
  optional string sku = 8;
  optional string category_hint = 9;
  google.protobuf.Timestamp created_at = 10;
  google.protobuf.Timestamp updated_at = 11;
}

message Receipt {
  int64 id = 1;
  ReceiptEngine engine = 2;
  ReceiptParseStatus parse_status = 3;
  ReceiptLinkStatus link_status = 4;
  repeated int64 match_ids = 5;

  // extracted fields
  optional string merchant = 6;
  optional google.type.Date purchase_date = 7;
  optional google.type.Money total_amount = 8;
  optional google.type.Money tax_amount = 9;

  // metadata & payloads
  optional Location location = 10;
  optional string raw_payload = 11;
  optional string canonical_data = 12;

  // timestamps & items
  google.protobuf.Timestamp created_at = 13;
  google.protobuf.Timestamp updated_at = 14;
  repeated ReceiptItem items = 15;
}

message TrendPoint {
  google.type.Date date = 1; // YYYY-MM-DD
  google.type.Money income = 2;
  google.type.Money expenses = 3;
}
